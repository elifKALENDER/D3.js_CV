<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Radial Chart</title>
  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <!-- Function for radial charts -->
  <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>
  <style>
    /* Style the text labels */
    .label {
      font-size: 11px;
      text-anchor: middle;
      dominant-baseline: central;
    }
    
    /* Adjust the size of the canvas */
    #my_dataviz svg {
      width: 600px;
      height: 600px;
    }
  </style>
</head>
<body>
  <!-- Create a div where the graph will take place -->
  <div id="my_dataviz"></div>

  <script>
    // Set the dimensions and margins of the graph
    var margin = {top: 100, right: 0, bottom: 0, left: 0},
      width = 460 - margin.left - margin.right,
      height = 460 - margin.top - margin.bottom,
      innerRadius = 90,
      outerRadius = Math.min(width, height) / 2;   // The outerRadius goes from the middle of the SVG area to the border

    // Append the SVG object
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate(" + (width / 2 + margin.left) + "," + (height / 2 + margin.top) + ")");

    // Define the dataset
    var dataset = {
      "name": "Skills",
      "children": [
        {
          "name": "Hard Skills",
          "children": [
            { "name": "C", "value": 4.0 },
            { "name": "C++", "value": 2.0 },
            { "name": "C#", "value": 6.0 },
            { "name": "Java", "value": 5.0 },
            { "name": "Python", "value": 3.0 },
            { "name": "CSS", "value": 7.0 },
            { "name": "HTML", "value": 7.0 },
            { "name": "Vray", "value": 7.5 },
            { "name": "3dsmax", "value": 8.0 },
            { "name": "Autocad", "value": 9.5 },
            { "name": "Revit", "value": 9.0 },
            { "name": "Lumion", "value": 8.0 },
            { "name": "Drawing", "value": 9.5 },
            { "name": "Model", "value": 7.5 },
            { "name": "3D Printing", "value": 5.0 },
            { "name": "Design", "value": 8.5 },
            { "name": "2D Drawing", "value": 9.5 },
            { "name": "Photoshop", "value": 7.0 }
          ]
        },
        {
          "name": "Soft Skills",
          "children": [
            { "name": "Communication", "value": 8.0 },
            { "name": "Problem Solving", "value": 9.5 },
            { "name": "Creativity", "value": 9.0 },
            { "name": "Analytical Thinking", "value": 8.5 },
            { "name": "Detail-oriented", "value": 7.0 }
          ]
        }
      ]
    };

    // Flatten the dataset to retrieve all skill entries
    var skills = [];
    dataset.children.forEach(function(category) {
      category.children.forEach(function(skill) {
        skill.category = category.name;  // Add category property to each skill
        skills.push(skill);
      });
    });

    // Compute the maximum value in the dataset
    var maxSkillValue = d3.max(skills, function(d) { return d.value; });

    // Scales
    var x = d3.scaleBand()
      .range([0, 2 * Math.PI])    // X axis goes from 0 to 2pi = all around the circle. If I stop at 1Pi, it will be around a half circle
      .align(0)                  // This does nothing
      .domain(skills.map(function(d) { return d.name; })); // The domain of the X axis is the list of skills
    var y = d3.scaleRadial()
      .range([innerRadius, outerRadius])   // Domain will be defined later
      .domain([0, maxSkillValue]); // Domain of Y is from 0 to the maximum skill value

    // Define colors for each skill category
    var categoryColors = {
      "Hard Skills": "#69b3a2",
      "Soft Skills": "#ff7f0e"
    };

    // Add the bars
    svg.append("g")
      .selectAll("path")
      .data(skills)
      .enter()
      .append("path")
        .attr("fill", function(d) { return categoryColors[d.category]; })  // Assign color based on category
        .attr("d", d3.arc()
          .innerRadius(innerRadius)
          .outerRadius(function(d) { return y(d.value); })
          .startAngle(function(d) { return x(d.name); })
          .endAngle(function(d) { return x(d.name) + x.bandwidth(); })
          .padAngle(0.01)
          .padRadius(innerRadius))
        .attr("stroke", function(d) { return d.value >= 80 ? "black" : "none"; })  // Add stroke for bars with value >= 80

    // Add the labels
    svg.append("g")
      .selectAll("g")
      .data(skills)
      .enter()
      .append("g")
        .attr("transform", function(d) {
          var angle = (x(d.name) + x.bandwidth() / 2) * 180 / Math.PI - 90;
          var radius = y(maxSkillValue) + 20; // Adjust the radius of the labels to be outside the bars
          return "rotate(" + angle + ")" + "translate(" + radius + ",0)" + "rotate(" + (angle > 90 ? 180 : 0) + ")"; // Rotate the labels based on the angle
        })
      .append("text")
        .attr("class", "label")
        .text(function(d){return d.name;});

  </script>
</body>
</html>
